{% extends 'web/base.html' %}

{% block content %}
{% verbatim %}

<div class="main-content">
  <div class="container" ng-app="cookbook">
    <form class="edit-recipe" ng-controller="RecipeController as rc" ng-submit="rc.submit(recipe)">
      <img src="/static/images/veggie_lasagna.jpg" alt="">
      <div class="recipe-header">
        <input class="field-input recipe-title" ng-model="rc.recipe.title" placeholder="Title"></input>
{% endverbatim %}
        <p class="recipe-author">by {{ user }}</p>
{% verbatim %}
      </div>
      <section class='recipe-description'>
        <textarea class="field-textarea recipe-description" ng-model="rc.recipe.description"></textarea>
      </section>
      <section>
        <div>
          <input class="field-input recipe-servings" ng-model="rc.recipe.serves">
        </div>
        <div>
          <input class="field-input recipe-servings" ng-model="rc.recipe.time">
        </div>
      </section>
      <section>
        <h4 class="recipe-section-heading">Equipment</h4>
        <ul>
          <li ng-repeat="equip in rc.equipment">
            <input class="field-input" ng-model="equip.name" placeholder="{{equip.placeholder}}">
          </li>
          <button type="button" class="button-add-item" ng-click="rc.addEquipment()">
            + Add Equipment
          </button>
        </ul>
      </section>
      <section>
        <h4 class="recipe-section-heading">Ingredients</h4>
        <ul>
          <li ng-repeat="ingredient in rc.ingredients">
            <input class="field-input" ng-model="ingredient.name" placeholder="{{ingredient.placeholder}}">
          </li>
          <button type="button" class="button-add-item" ng-click="rc.addIngredient()">
            + Add Ingredient
          </button>
        </ul>
      </section>
      <section>
        <h4 class="recipe-section-heading">Preperations</h4>
        <ol class="recipe-preparation-list">
          <li ng-repeat="instruction in rc.instructions">
            <textarea class="field-textarea" ng-model="instruction.description" placeholder="{{instruction.placeholder}}"></textarea>
          </li>
          <button type="button" class="button-add-item button-add-item--textarea" ng-click="rc.addInstruction()">
              + Add Step
          </button>
        </ol>
      </section>
      <section class="form-footer">
        <button type="submit" class="button-save">Save</button>
        <button type="button" class="button-publish" ng-click="rc.publish()">Publish</button>
      </section>
    </form>
  </div>
</div>

{% endverbatim %}
{% endblock content %}

{% block javascript %}

<script>
{% if recipe %}
  var recipe = {
    id: '{{ recipe.id }}',
    title: '{{ recipe.title }}',
    slug: '{{ recipe.slug }}',
    description: '{{ recipe.description }}',
    serves: '{{ recipe.serves }}',
    time: '{{ recipe.time }}',
    equipment: [
      {% for equipment in recipe.equipment.all %}
        { name: '{{ equipment.name }}' },
      {% endfor %}
    ],
    ingredients: [
      {% for ingredient in recipe.ingredients.all %}
        { name: '{{ ingredient.name }}' },
      {% endfor %}
    ],
    instructions: [
      {% for instruction in recipe.instructions.all %}
        {
          description: '{{ instruction.description }}',
          order: '{{ instruction.order }}',
        },
      {% endfor %}
    ],
    draft: '{{ recipe.draft }}',
  };
{% else %}
  var recipe = {
    title: 'New Recipe',
    description: 'Write a description for the brilliant new recipe you came up with that makes your mouth water',
    serves: 'Serves 5',
    time: '30 - 40 min',
    equipment: [
      { name: 'Rolling pin' },
      { name: 'Cake tin' },
    ],
    ingredients: [
      { name: '3 cups of flour' },
      { name: '1 stick of butter' },
    ],
    instructions: [
      { description: 'This is what you do first...', placeholder: 'Step 1', order: 0 },
      { placeholder: 'Step 2', order: 1 },
      { placeholder: 'Step 3', order: 2 },
    ],
  };
{% endif %}
</script>

<script src="/static/libs/angular.min.js"></script>
<script src="/static/app.js"></script>

{% endblock javascript %}
